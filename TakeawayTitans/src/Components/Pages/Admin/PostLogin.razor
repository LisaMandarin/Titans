@page "/postlogin"
@inject IHttpContextAccessor Http
@inject NavigationManager Nav

@code {
  [SupplyParameterFromQuery(Name = "token")]
  public string? Token { get; set; }
  bool _done;

  protected override Task OnAfterRenderAsync(bool firstRender)
  {
    if (!firstRender || _done) return Task.CompletedTask;
    _done = true;

    if (!string.IsNullOrWhiteSpace(Token))
    {
      Http.HttpContext!.Response.Cookies.Append(
        BlazorConstants.AuthCookieName,                // must match your provider & cookie options
        Token,
        new CookieOptions {
          HttpOnly = true,
          Secure = true,                               // Render uses HTTPS
          SameSite = SameSiteMode.Lax,
          Expires = DateTimeOffset.UtcNow.AddMinutes(30)
        }
      );
    }

    // hop to the dashboard with a clean URL
    Nav.NavigateTo("/admin-dashboard", replace: true, forceLoad: true);
    return Task.CompletedTask;
  }
}
